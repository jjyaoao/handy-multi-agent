# 2.4 Messages

## 2.4.1 概述

> **什么是 Agent 的 Message？**

当你和朋友聊天、在网上搜索信息或是对手机语音助手说"帮我查一下天气"时，其实你都在向某个"代理者(Agent)"发送一条"信息(Message)"。这里的"代理者"既可以是一个人，也可以是一个能执行指令的智能程序或系统，而"信息"则是你传递的指令、问题或数据。在日常生活中，这种信息交互常常不易察觉，但在计算机科学、人工智能和自动化任务中，"Agent的Message"是一个至关重要的基础概念。

简单来说，**Agent的Message就是指系统中"智能体"或"代理者"之间互相传递的指令或数据包**。就好比你给朋友发一条微信消息请他帮忙带杯咖啡，在智能系统中，"Agent"则是那些负责完成任务的角色，而"Message"则是他们沟通和协作的工具。当一个Agent收到Message后，会根据内容做出决策、执行任务或回复信息。

在 CAMEL 系统中，`BaseMessage` 是所有消息对象的基础类，它为对话中的每一条信息提供了统一的结构和标准化的处理方式。无论是用户输入的一段文本，还是包含图片、视频等多模态信息的数据包，都可以通过 `BaseMessage` 来统一表示和管理。

> **为什么需要统一的消息结构？**

在一个对话系统中，消息可能来自多方（如用户、系统、不同类型的 Agent），且信息内容不局限于纯文本，还可能包括图像、视频甚至是自定义的元数据（metadata）。如果没有一个统一的基础类来约束这些消息的格式，开发者就会面临如下问题：

* **类型繁杂且难以维护**：不同消息类型需要各自的代码逻辑和数据结构，导致系统复杂度提高。

* **难以扩展和对接**：当需要增加新类型的消息（如引入新媒体格式或上下文信息）时，很可能需要大幅度修改原有代码。

* **通用处理困难**：缺乏统一结构会让调试、日志记录和分析对话信息变得更加麻烦。

通过使用 `BaseMessage`，你可以：

* 将消息的创建、变形（如格式转换）和传递标准化。

* 简化对消息类型的扩展，提高代码的可维护性和可读性。

* 为后续的功能模块（如消息过滤、路由、多轮对话管理）提供一个统一的数据基础。

并且熟练掌握Message相关内容，对我们后续无论是做RAG应用或者模型的Fine-tune都非常重要！在后续章节我们会为大家介绍。

## 2.4.2 创建和使用Message

在了解了 `BaseMessage` 存在的意义后，让我们直接通过实例化来看看如何创建和使用它。通过一个最小化示例，我们将掌握 `BaseMessage` 的关键属性和基本用法，再进一步扩展到多模态内容。

**创建 `BaseMessage` 实例的最小化示例**

下面是一个最基本的代码示例，将创建一条来自用户的文本消息：

在上述示例中，我们创建了一条来自 `example_user` 的 USER 类型消息，内容为纯文本 `"Hello, CAMEL!"`。这就是一个最小化的 `BaseMessage` 示例。

**关键属性介绍**

* `role_name`：给消息一个容易辨识的名称，如 `"User"`、`"Assistant"` 或 `"System"`。在更复杂的场景中，你或许会有多个用户、多个 Agent，通过 `role_name` 能帮助你追踪消息来源。

* `role_type`：角色类型一般来自 `RoleType` 枚举，以明确此消息在对话中的身份。例如：
  * `RoleType.USER`：表示该消息来自用户
  * `RoleType.ASSISTANT`：表示该消息来自智能助手

* `content`：消息的核心载体，一般是文本，也可能是解析指令、问题描述或描述性文字。

**简单扩展：添加多模态内容**

除了纯文本外，`BaseMessage` 还支持包含图片、视频等多模态信息。这可以为你的对话系统带来更丰富的交互体验。下面的示例展示了如何向 `BaseMessage` 添加一张图片。假设你已将一张图片加载为 `PIL.Image` 对象：

同理，如果你有视频数据（如 `video_bytes`），也可将视频信息传入 `BaseMessage`。当你的消息中包含图片、视频等丰富媒体信息时，后续的组件（如 `ChatAgent`）便可利用这些多模态数据进行更智能和灵活的响应。

## 2.4.3 不同类型消息的处理

在使用 `BaseMessage` 的过程中，你不仅可以轻松创建基本的用户消息，也能够通过其内置方法快速生成其它类型（如系统消息、助手消息）的实例，并对其内容进行更新和转换。此外，`BaseMessage` 提供了多种便利的转换方法，可将消息转化为不同格式，便于对接诸如 OpenAI 等后端服务。

**快速生成不同类型的消息**

通过 `BaseMessage` 的类方法，我们可以快捷创建出用户（User）、助手（Assistant）的消息： 